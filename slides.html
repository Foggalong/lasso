<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Sparse Modeling &amp; Lasso</title>
    <meta charset="utf-8" />
    <meta name="author" content="Josh Fogg" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="libs/sass320bd65997cef40a04f58fcb10ad01f0/edtheme.min.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Sparse Modeling &amp; Lasso
]
.subtitle[
## Lecture 6 - MATH11301
]
.author[
### Josh Fogg
]

---


&lt;!-- Blocks that do setup for the rest of the document--&gt;


&lt;style type="text/css"&gt;
.scroll-300 {
  /* enable scrolling output for large code blocks */
  max-height: 300px;
  overflow-y: auto;
}
&lt;/style&gt;

## Outline

&lt;font size="6"&gt; &lt;!--Create diagonal with contents and comic--&gt;
  1. Regression Recap&lt;br&gt;
  2. Subset Selection&lt;br&gt;
  3. Shrinkage Methods&lt;br&gt;
  4. Dimension Reduction&lt;br&gt;
&lt;/font&gt;

&lt;img src="https://imgs.xkcd.com/comics/linear_regression.png" alt="Two square panels show identical sets of scattered black dots, with only the red additions being different. The left panel shows a slightly rising red line drawn through the middle of the panel, passing near a few dots but not obviously related to most of them. A red text is below the dots: R-squared = 0.06. The right panel shows many of the dots connected by red lines to form a stick figure of a man resembling the constellation Orion, with the hand on the reader's right raised and holding an object. A red text is below the dots: Rexthor, the Dog-Bearer. A caption is below and spanning both panels: I don't trust linear regressions when it's harder to guess the direction of the correlation from the scatter plot than to find new constellations on it." width="50%" style="display: block; margin: auto 0 auto auto;" /&gt;

---
class: inverse, middle, center

# 1. Regression Recap

---

## Simple Linear Regression

Given response `\(y\)` and **single** predictor `\(x\)`, this model fits to `\(y = \beta_{0} + \beta_{1}x\)`.

&lt;img src="slides_files/figure-html/scatter-plot-1.svg" style="display: block; margin: auto;" /&gt;

For `\(n\)` observations `\((x^{(i)}, y^{(i)})\)`, the fit is found by minimizing the residual sum of squares:

`\begin{equation}
  \min_{\beta_0,\beta_1} \left( \sum_{i=1}^n {\left({ y^{(i)} - \beta_0 - \beta_{1}x^{(i)} }\right)}^2 \right).
\end{equation}`

---

## Multiple Linear Regression

Typically in real data, we have **multiple** predictors for a response variable.

Given `\(n\)` observations of

- response variable `\(y\)`,
- vector of `\(p\)` predictors, `\({\bf x} = (x_{1}, x_{2}, \ldots, x_{p})\)`,

the linear regression model is

$$
 y = \beta_0 + \beta_1x_1 + \beta_2x_2 + \cdots + \beta_px_p + \varepsilon,
$$

again, fit using least squares procedure:

`\begin{equation}
  \min_{\beta_0, \beta_1, \ldots, \beta_p} \left(\sum_{i=1}^n {\left( y^{(i)} - \beta_0 - \sum_{i=1}^p\beta_{j}x_{j}^{(i)} \right)}^2 \right) =: \min_{{\bf\beta}}(\operatorname{RSS}).
\end{equation}`

---
class: inverse, middle, center

## What are the practical issues here?

$$
 y = \beta_0 + \beta_1x_1 + \beta_2x_2 + \cdots + \beta_px_p
$$

---



## Example Linear Model

In &lt;abbr title="Introduction to Data Science, one of the first year maths courses here in Edinburgh."&gt;IDS&lt;/abbr&gt;, we fit a linear model to the [Lending Club's `loans` dataset](https://openintrostat.github.io/openintro/reference/loans_full_schema.html).

&lt;table class="table table-striped table-condensed" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; term &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; estimate &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; std.error &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; statistic &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p.value &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;width: 15em; font-family: monospace;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 1.89 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.21 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 9.01 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; &amp;lt; 0.001 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;width: 15em; font-family: monospace;"&gt; income_Source Verified &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 1.00 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.10 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 10.06 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; &amp;lt; 0.001 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;width: 15em; font-family: monospace;"&gt; income_Verified &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 2.56 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.12 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 21.87 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; &amp;lt; 0.001 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;width: 15em; font-family: monospace;"&gt; debt_to_income &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.02 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.00 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 7.43 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; &amp;lt; 0.001 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;width: 15em; font-family: monospace;"&gt; credit_util &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 4.90 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.16 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 30.25 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; &amp;lt; 0.001 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;width: 15em; font-family: monospace;"&gt; bankruptcy1 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.39 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.13 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 2.96 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.003 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;width: 15em; font-family: monospace;"&gt; term &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.15 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.00 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 38.89 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; &amp;lt; 0.001 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;width: 15em; font-family: monospace;"&gt; credit_checks &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.23 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.02 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 12.52 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; &amp;lt; 0.001 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;width: 15em; font-family: monospace;"&gt; issue_monthJan-2018 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.05 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.11 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.42 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.674 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;width: 15em; font-family: monospace;"&gt; issue_monthMar-2018 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; -0.04 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.11 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; -0.39 &lt;/td&gt;
   &lt;td style="text-align:right;width: 5em; "&gt; 0.696 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
class: inverse, middle, center

# 2. Subset Selection

---

## Model Selection

We have a model that works with all the predictors, but could we do better?

&gt; _"Of two competing theories, the simpler explanation is to be preferred."_ (Ockham's Razor)

--

Recall, to compare models of differing size we can use a metric such as the **Akaike information criterion**, which for least squares is

`\begin{equation}
  \operatorname{AIC} = \frac{1}{n}\left( {\operatorname{RSS} + 2d\hat{\sigma}^2} \right).
\end{equation}`

or the adjusted `\(R^2\)` value,

`\begin{equation}
  \operatorname{Adjusted}~R^2 = 1 - \frac{\operatorname{RSS}/(n-d-1)}{\operatorname{TSS}/(n-1)},
\end{equation}`

where `\(\operatorname{TSS} = \sum_i {(y_i-\bar{y})}^2\)` and `\(d\)` is the number of variables in the model.

---

### Backward Selection

Starting with full model, successively remove predictors until the criterion can't improve.


``` r
full_model &lt;- lm(interest_rate~., data=loans_ids)
backward &lt;- step(full_model, direction='backward')
```

``` scroll-300
## Start:  AIC=29106.05
## interest_rate ~ income_ + debt_to_income + credit_util + bankruptcy + 
##     term + credit_checks + issue_month
## 
##                  Df Sum of Sq    RSS   AIC
## - issue_month     2      13.3 184240 29103
## &lt;none&gt;                        184227 29106
## - bankruptcy      1     161.6 184389 29113
## - debt_to_income  1    1021.7 185249 29159
## - credit_checks   1    2896.3 187123 29260
## - income_         2    8845.9 193073 29570
## - credit_util     1   16918.2 201145 29980
## - term            1   27962.5 212190 30514
## 
## Step:  AIC=29102.77
## interest_rate ~ income_ + debt_to_income + credit_util + bankruptcy + 
##     term + credit_checks
## 
##                  Df Sum of Sq    RSS   AIC
## &lt;none&gt;                        184240 29103
## - bankruptcy      1     162.1 184402 29110
## - debt_to_income  1    1023.7 185264 29156
## - credit_checks   1    2898.7 187139 29257
## - income_         2    8836.1 193076 29566
## - credit_util     1   16921.3 201162 29977
## - term            1   27964.1 212204 30510
```

---

### Forward Selection

Starting with the empty model, successively add predictors until criterion can't improve.


``` r
empty_model &lt;- lm(interest_rate~1, data=na.omit(loans_ids))
forward &lt;- step(empty_model, direction='forward', scope = formula(full_model))
```

``` scroll-300
## Start:  AIC=32096.14
## interest_rate ~ 1
## 
##                  Df Sum of Sq    RSS   AIC
## + term            1     31980 217097 30728
## + credit_util     1     16104 232972 31431
## + income_         2     15101 233976 31476
## + debt_to_income  1      5018 244059 31895
## + credit_checks   1      4297 244780 31925
## + bankruptcy      1       576 248501 32075
## &lt;none&gt;                        249077 32096
## + issue_month     2        25 249052 32099
## 
## Step:  AIC=30727.54
## interest_rate ~ term
## 
##                  Df Sum of Sq    RSS   AIC
## + credit_util     1   17987.8 199109 29867
## + income_         2   10212.9 206884 30251
## + debt_to_income  1    3921.0 213176 30548
## + credit_checks   1    3635.1 213462 30561
## + bankruptcy      1     556.7 216540 30704
## &lt;none&gt;                        217097 30728
## + issue_month     2       6.3 217091 30731
## 
## Step:  AIC=29866.88
## interest_rate ~ term + credit_util
## 
##                  Df Sum of Sq    RSS   AIC
## + income_         2   10562.8 188546 29327
## + credit_checks   1    4000.8 195109 29666
## + debt_to_income  1    2011.2 197098 29768
## + bankruptcy      1     332.0 198777 29852
## &lt;none&gt;                        199109 29867
## + issue_month     2       4.5 199105 29871
## 
## Step:  AIC=29327.2
## interest_rate ~ term + credit_util + income_
## 
##                  Df Sum of Sq    RSS   AIC
## + credit_checks   1   3119.02 185427 29163
## + debt_to_income  1   1114.30 187432 29270
## + bankruptcy      1    297.31 188249 29314
## &lt;none&gt;                        188546 29327
## + issue_month     2     18.80 188528 29330
## 
## Step:  AIC=29162.83
## interest_rate ~ term + credit_util + income_ + credit_checks
## 
##                  Df Sum of Sq    RSS   AIC
## + debt_to_income  1   1025.02 184402 29110
## + bankruptcy      1    163.43 185264 29156
## &lt;none&gt;                        185427 29163
## + issue_month     2     15.80 185412 29166
## 
## Step:  AIC=29109.54
## interest_rate ~ term + credit_util + income_ + credit_checks + 
##     debt_to_income
## 
##               Df Sum of Sq    RSS   AIC
## + bankruptcy   1   162.075 184240 29103
## &lt;none&gt;                     184402 29110
## + issue_month  2    13.712 184389 29113
## 
## Step:  AIC=29102.77
## interest_rate ~ term + credit_util + income_ + credit_checks + 
##     debt_to_income + bankruptcy
## 
##               Df Sum of Sq    RSS   AIC
## &lt;none&gt;                     184240 29103
## + issue_month  2    13.253 184227 29106
```
---

### Hybrid Approaches

Backward selection requires that `\(n &gt; p\)` in order to yield a unique least-squares solution. Forward selection works with high-dimensional data when `\(n &lt; p\)` (potentially `\(n \ll p\)`).

--

Both beat exhaustion, going from checking `\(2^p\)` models ([NP-complete](https://en.wikipedia.org/wiki/NP-completeness)) to `\(1+\frac{p(p+1)}{2}\)` ([P](https://en.wikipedia.org/wiki/P_(complexity)), but neither are guaranteed to find the optimal `\(d\)`-predictor model.

--

In practice, we often take combined approach: removing obsolete variables from the model whenever a new one is added.

```r
empty_model &lt;- lm(interest_rate~., data=loans_ids)
hybrid &lt;- step(empty_model, direction='both')
```

The aim is to mimic the 'benefits' of an exhaustive search while retaining the efficiency of subset selection.

--

Both work well if `\(p \ll d\)`, but **neither is performant when we expect the model to use even a moderate number of variables.**

---
class: inverse, middle, center

# 3. Shrinkage Methods

---

## The Lasso

Subset selection aren't the only way to tune a model. Here's a more _optimum_ approach.

More text should follow here. 

---

### Tuning

Something about parameter tuning.

---

## The Ridge

Hello, world!

---

## Least Angle Regression

Hello, world!

---
class: inverse, middle, center

# 4. Dimension Reduction

---

## Placeholder

Hello, world!

---
class: inverse, middle, center

# End
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
